<!doctype html>
<html lang="ru" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Selenization Alfa 0.1</title>
    <meta name="description" content="Selenization Alfa 0.1 — минималистичный интерфейс чата ИИ" />
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs/%3E%3Crect width='100' height='100' rx='22' fill='%231e293b'/%3E%3Ctext x='50' y='58' font-family='Arial,Helvetica,sans-serif' font-weight='700' font-size='44' text-anchor='middle' fill='white'%3ESA%3C/text%3E%3C/svg%3E" />

    <!-- Tailwind CDN (standalone) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' };</script>

    <!-- React & ReactDOM via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Polyfill for older browsers (optional) -->
    <script>window.process = window.process || { env: {} };</script>

    <style>
      /* Smooth scrolling for message view */
      .scroll-smooth { scroll-behavior: smooth; }
      /* Simple keyframe for typing dots */
      @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20%); } }
      .animate-bounce { animation: bounce 1s infinite; }
    </style>
  </head>
  <body class="h-full bg-gradient-to-br from-sky-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-950 dark:to-slate-900">
    <div id="root" class="h-full"></div>

    <script type="text/javascript">
      (function () {
        const { useEffect, useMemo, useRef, useState } = React;

        function cx() { return Array.from(arguments).filter(Boolean).join(' '); }

        function Logo(props) {
          const compact = props && props.compact;
          return React.createElement('div', { className: 'flex items-center gap-2 select-none' },
            React.createElement('div', { className: 'relative' },
              React.createElement('span', { className: 'absolute inset-0 blur-md rounded-full bg-gradient-to-tr from-indigo-500 via-sky-400 to-cyan-300 opacity-60' }),
              React.createElement('span', { className: 'relative inline-flex h-8 w-8 items-center justify-center rounded-2xl bg-gradient-to-tr from-indigo-600 to-sky-500 text-white font-semibold shadow-md' }, 'SA')
            ),
            !compact && React.createElement('div', { className: 'leading-tight' },
              React.createElement('div', { className: 'text-sm font-semibold tracking-wide text-slate-800 dark:text-slate-100' }, 'Selenization'),
              React.createElement('div', { className: 'text-[10px] uppercase tracking-wider text-slate-500 dark:text-slate-400' }, 'Alfa 0.1')
            )
          );
        }

        function rid() {
          const a = (window.crypto && crypto.getRandomValues) ? crypto.getRandomValues(new Uint32Array(2)) : [Math.random()*1e9>>>0,Math.random()*1e9>>>0];
          return Array.from(a).map(x => x.toString(16)).join('');
        }

        function sampleThread(variant) {
          const introMap = {
            1: 'Можешь тезисно законспектировать встречу и выделить action items?',
            2: 'Давай идеи для лендинга с акцентом на простоту и научный вайб.',
            3: 'Собери основные выводы из переписки за неделю.'
          };
          const replyMap = {
            1: 'Конечно! Вот краткое резюме: цели, риски, дедлайны; действия: создать бриф, согласовать KPI, назначить владельцев.',
            2: 'Предлагаю 3 секции: ценность продукта, демо, социальное доказательство. CTA — “Попробовать”.',
            3: 'Ключевые темы: прогресс по задачам, блокеры, план на следующую неделю.'
          };
          const intro = introMap[variant || 1];
          const reply = replyMap[variant || 1];
          return [
            { id: rid(), role: 'user', text: intro, ts: Date.now() - 1000 * 60 * 45 },
            { id: rid(), role: 'assistant', text: reply, ts: Date.now() - 1000 * 60 * 44 }
          ];
        }

        const defaultPrompts = [
          { id: rid(), title: 'Kickoff Notes S…', last: Date.now() - 1000 * 60 * 5, messages: sampleThread(1) },
          { id: rid(), title: 'Brainstorming B…', last: Date.now() - 1000 * 60 * 60 * 2, messages: sampleThread(2) },
          { id: rid(), title: 'Executive Summary', last: Date.now() - 1000 * 60 * 60 * 26, messages: sampleThread(3) }
        ];

        function useStickyState(key, initial) {
          const [state, setState] = useState(() => {
            try { const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : initial; } catch { return initial; }
          });
          useEffect(() => { try { localStorage.setItem(key, JSON.stringify(state)); } catch {} }, [key, state]);
          return [state, setState];
        }

        function UserAvatar() { return React.createElement('div', { className: 'h-8 w-8 rounded-full bg-gradient-to-tr from-slate-400 to-slate-600 text-white flex items-center justify-center text-xs font-semibold shadow' }, 'Я'); }
        function BotAvatar() { return React.createElement('div', { className: 'h-8 w-8 rounded-2xl bg-gradient-to-tr from-indigo-600 to-sky-500 text-white flex items-center justify-center text-xs font-bold shadow' }, 'SA'); }

        function IconButton(props) {
          return React.createElement('button', { onClick: props.onClick, title: props.label, className: 'p-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-white/10' }, props.children, React.createElement('span', { className: 'sr-only' }, props.label));
        }
        function PencilIcon() { return React.createElement('svg', { xmlns:'http://www.w3.org/2000/svg', viewBox:'0 0 24 24', fill:'currentColor', className:'h-4 w-4' }, React.createElement('path', { d:'M16.862 3.487a1.5 1.5 0 0 1 2.121 0l1.53 1.53a1.5 1.5 0 0 1 0 2.121l-9.9 9.9a2 2 0 0 1-.864.506l-4.14 1.184a.5.5 0 0 1-.62-.62l1.185-4.14a2 2 0 0 1 .505-.864l9.9-9.9z'})); }
        function TrashIcon() { return React.createElement('svg', { xmlns:'http://www.w3.org/2000/svg', viewBox:'0 0 24 24', fill:'currentColor', className:'h-4 w-4' }, React.createElement('path', { d:'M9 3h6a1 1 0 0 1 1 1v1h5v2H3V5h5V4a1 1 0 0 1 1-1zm-2 6h2v10H7V9zm4 0h2v10h-2V9zm4 0h2v10h-2V9z'})); }
        function DownloadIcon() { return React.createElement('svg', { xmlns:'http://www.w3.org/2000/svg', viewBox:'0 0 24 24', fill:'currentColor', className:'h-4 w-4' }, React.createElement('path', { d:'M12 3a1 1 0 0 1 1 1v8.586l2.293-2.293 1.414 1.414L12 16.414 7.293 11.707l1.414-1.414L11 12.586V4a1 1 0 0 1 1-1zm-9 14h18v2H3v-2z'})); }
        function PaperclipIcon() { return React.createElement('svg', { xmlns:'http://www.w3.org/2000/svg', viewBox:'0 0 24 24', fill:'currentColor', className:'h-5 w-5' }, React.createElement('path', { d:'M7 7.5v7a5 5 0 1 0 10 0V6a3 3 0 0 0-6 0v8a1 1 0 1 0 2 0V6a1 1 0 1 1 2 0v8a3 3 0 1 1-6 0v-6.5H7z'})); }

        function ThemeIcon(props){
          if (props.mode === 'dark') return React.createElement('svg', { xmlns:'http://www.w3.org/2000/svg', viewBox:'0 0 24 24', fill:'currentColor', className:'h-4 w-4' }, React.createElement('path', { d:'M21 12.79A9 9 0 1 1 11.21 3 7 7 0 1 0 21 12.79z'}));
          return React.createElement('svg', { xmlns:'http://www.w3.org/2000/svg', viewBox:'0 0 24 24', fill:'currentColor', className:'h-4 w-4' }, React.createElement('path', { d:'M12 4a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0V5a1 1 0 0 1 1-1zm0 13a5 5 0 1 1 0-10 5 5 0 0 1 0 10zm8-5a1 1 0 0 1 1 1v0a1 1 0 1 1-2 0v0a1 1 0 0 1 1-1zM4 12a1 1 0 0 1 1 1v0a1 1 0 1 1-2 0v0a1 1 0 0 1 1-1zm12.95 6.536a1 1 0 0 1 1.414 1.414l-.707.707a1 1 0 0 1-1.414-1.414l.707-.707zM5.343 5.343a1 1 0 0 1 1.414 0l.707.707A1 1 0 0 1 6.05 7.464l-.707-.707a1 1 0 0 1 0-1.414z'}));
        }

        function EmptyState(){
          const examples = ['Суммаризируй встречу по проекту Titan','Сгенерируй список идей для лендинга','Выдели action items из заметок'];
          return React.createElement('div', { className: 'mx-auto max-w-2xl text-center py-16 text-slate-600 dark:text-slate-300' },
            React.createElement('div', { className: 'mb-3 flex justify-center' }, React.createElement(Logo, null)),
            React.createElement('h2', { className: 'text-xl font-semibold' }, 'Добро пожаловать в Selenization Alfa 0.1'),
            React.createElement('p', { className: 'text-sm mt-1' }, 'Задайте вопрос или начните новую беседу. Вот несколько вариантов:'),
            React.createElement('div', { className: 'mt-4 flex flex-wrap justify-center gap-2' },
              examples.map(function(x){ return React.createElement('span', { key:x, className:'px-3 py-1.5 text-xs rounded-full border border-slate-200 dark:border-white/10 bg-white/60 dark:bg-white/5' }, x); })
            )
          );
        }

        function MessageBubble(props){
          const isUser = props.role === 'user';
          return React.createElement('div', { className: 'w-full' },
            React.createElement('div', { className: cx('max-w-3xl mx-auto flex gap-3', isUser ? 'flex-row-reverse' : 'flex-row') },
              React.createElement('div', { className: 'shrink-0' }, isUser ? React.createElement(UserAvatar) : React.createElement(BotAvatar)),
              React.createElement('div', { className: cx('rounded-2xl px-4 py-3 shadow-sm border', isUser ? 'bg-sky-50 border-sky-100 text-slate-900 dark:bg-sky-900/30 dark:border-sky-900/40 dark:text-slate-100' : 'bg-white/80 border-slate-200 text-slate-800 dark:bg-slate-800/70 dark:border-white/10 dark:text-slate-100') },
                React.createElement('div', { className: 'text-sm whitespace-pre-wrap leading-6' }, props.text),
                React.createElement('div', { className: 'mt-1 text-[10px] uppercase tracking-wide text-slate-400 dark:text-slate-500' }, new Date(props.ts).toLocaleTimeString())
              )
            )
          );
        }

        function AssistantTyping(){
          return React.createElement('div', { className: 'max-w-3xl mx-auto flex gap-3' },
            React.createElement('div', { className: 'shrink-0' }, React.createElement(BotAvatar)),
            React.createElement('div', { className: 'rounded-2xl px-4 py-3 shadow-sm border bg-white/80 border-slate-200 text-slate-800 dark:bg-slate-800/70 dark:border-white/10 dark:text-slate-100' },
              React.createElement(TypingDots)
            )
          );
        }

        function TypingDots(){
          return React.createElement('span', { className: 'inline-flex gap-1 items-center' },
            [0,1,2].map(function(i){
              return React.createElement('span', { key: i, className: 'inline-block h-2 w-2 rounded-full bg-current opacity-60 animate-bounce', style: { animationDelay: (i*0.15)+'s' } });
            })
          );
        }

        function summarize(t){ t = (t||'').replace(/\s+/g,' ').trim(); const m=120; return t.length>m? t.slice(0,m-1)+'…': t; }
        function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1); }
        function extractActions(text){
          const verbs = ['собери','выдели','создай','подготовь','проанализируй','суммаризируй','составь','проверь','найди'];
          const lower = (text||'').toLowerCase();
          const res=[]; verbs.forEach(function(v){ if(lower.includes(v)) res.push(capitalize(v)+' результат'); });
          if(/\bкп[иа]\b|kpi/.test(lower)) res.push('Согласовать KPI');
          if(/дедлайн|срок/.test(lower)) res.push('Уточнить дедлайны');
          return Array.from(new Set(res));
        }

        function mockModelReply(prompt){
          return new Promise(function(resolve){ setTimeout(function(){
            const actions = extractActions(prompt); const bullets = actions.length? '\n\nДействия:'+actions.map(a=>'\n• '+a).join('') : '';
            resolve('Понял задачу: '+ summarize(prompt) +'.'+ bullets + '\n\nГотов продолжить.');
          }, 700); });
        }

        function App(){
          const [theme, setTheme] = useStickyState('selenization_theme', 'light');
          const [chats, setChats] = useStickyState('selenization_chats_html', defaultPrompts);
          const [activeId, setActiveId] = useStickyState('selenization_active_html', (defaultPrompts[0]||{}).id);
          const [input, setInput] = useState('');
          const [isThinking, setIsThinking] = useState(false);
          const scrollRef = useRef(null);

          const active = useMemo(function(){ return chats.find(function(c){ return c.id===activeId; }) || chats[0]; }, [chats, activeId]);

          useEffect(function(){ document.documentElement.classList.toggle('dark', theme==='dark'); }, [theme]);
          useEffect(function(){ var el = scrollRef.current; if(el) el.scrollTo({ top: el.scrollHeight, behavior: 'smooth' }); }, [active && active.messages && active.messages.length, isThinking]);

          function createChat(){ const c={ id: rid(), title:'Новый диалог', last: Date.now(), messages: [] }; setChats(function(v){ return [c].concat(v); }); setActiveId(c.id); }
          function removeChat(id){ setChats(function(v){ return v.filter(function(c){ return c.id!==id; }); }); if(id===activeId){ const nxt = chats.find(function(c){ return c.id!==id; }); setActiveId(nxt? nxt.id: ''); } }
          function renameChat(id){ var title = prompt('Новое название диалога:', (chats.find(function(c){ return c.id===id; })||{}).title||''); if(title){ setChats(function(v){ return v.map(function(c){ return c.id===id? Object.assign({}, c, { title: title }): c; }); }); } }
          function exportChat(c){ var blob = new Blob([JSON.stringify(c,null,2)], { type:'application/json' }); var url = URL.createObjectURL(blob); var a = document.createElement('a'); a.href = url; a.download = 'Selenization_'+(c.title||'chat')+'.json'; a.click(); URL.revokeObjectURL(url); }

          async function onSend(){ var trimmed = (input||'').trim(); if(!trimmed || isThinking) return; setInput('');
            setChats(function(v){ return v.map(function(c){ return c.id===active.id? Object.assign({}, c, { last: Date.now(), messages: c.messages.concat([{ id: rid(), role:'user', text: trimmed, ts: Date.now() }]) }): c; }); });
            setIsThinking(true);
            var reply = await mockModelReply(trimmed);
            setChats(function(v){ return v.map(function(c){ return c.id===active.id? Object.assign({}, c, { last: Date.now(), messages: c.messages.concat([{ id: rid(), role:'assistant', text: reply, ts: Date.now() }]) }): c; }); });
            setIsThinking(false);
          }

          return React.createElement('div', { className:'h-full w-full overflow-hidden' },
            React.createElement('div', { className:'h-full w-full p-4 sm:p-6' },
              React.createElement('div', { className:'mx-auto h-full max-w-6xl rounded-3xl bg-white/80 backdrop-blur shadow-xl ring-1 ring-slate-900/10 dark:bg-slate-900/70 dark:ring-white/10 flex' },
                // Sidebar
                React.createElement('aside', { className: 'hidden md:flex md:w-72 lg:w-80 flex-col border-r border-slate-200/70 dark:border-white/10 p-4 gap-4' },
                  React.createElement('div', { className: 'flex items-center justify-between' },
                    React.createElement(Logo, null),
                    React.createElement('button', { onClick: createChat, className:'px-3 py-1.5 text-sm rounded-xl bg-slate-900 text-white dark:bg-white dark:text-slate-900 shadow hover:opacity-90', title:'Новый диалог' }, '+ Новый')
                  ),
                  React.createElement('div', { className: 'flex-1 overflow-y-auto pr-1' },
                    chats.length===0 ? React.createElement('div', { className:'text-sm text-slate-500 dark:text-slate-400' }, 'Нет диалогов. Создайте первый.') :
                    React.createElement('ul', { className:'space-y-1' },
                      chats.map(function(c){ return React.createElement('li', { key:c.id },
                        React.createElement('button', { onClick: function(){ setActiveId(c.id); }, className: cx('w-full text-left px-3 py-2 rounded-2xl transition flex items-center justify-between', c.id===activeId? 'bg-sky-100/80 text-slate-900 dark:bg-sky-900/40 dark:text-white' : 'hover:bg-slate-100/70 dark:hover:bg-white/5') },
                          React.createElement('span', { className:'truncate pr-2 text-sm' }, c.title),
                          React.createElement('div', { className:'flex items-center gap-1 opacity-70' },
                            React.createElement(IconButton, { label:'Переименовать', onClick: function(e){ e.stopPropagation(); renameChat(c.id); } }, React.createElement(PencilIcon)),
                            React.createElement(IconButton, { label:'Экспорт', onClick: function(e){ e.stopPropagation(); exportChat(c); } }, React.createElement(DownloadIcon)),
                            React.createElement(IconButton, { label:'Удалить', onClick: function(e){ e.stopPropagation(); removeChat(c.id); } }, React.createElement(TrashIcon))
                          )
                        )
                      ); })
                    )
                  ),
                  React.createElement('div', { className:'flex items-center justify-between' },
                    React.createElement('button', { onClick: function(){ setTheme(theme==='dark'?'light':'dark'); }, className:'flex items-center gap-2 px-3 py-2 rounded-2xl border border-slate-200 dark:border-white/10 text-sm hover:bg-slate-50 dark:hover:bg-white/5', title:'Переключить тему' }, React.createElement(ThemeIcon, { mode: theme }), React.createElement('span', { className:'hidden lg:inline' }, 'Тема: ', theme==='dark'?'тёмная':'светлая'))
                  )
                ),
                // Main
                React.createElement('main', { className:'flex-1 flex flex-col' },
                  React.createElement('div', { className:'flex items-center justify-between px-4 md:px-6 py-4 border-b border-slate-200/70 dark:border-white/10' },
                    React.createElement('div', { className:'flex items-center gap-3' },
                      React.createElement('div', { className:'md:hidden' }, React.createElement(Logo, { compact:true })),
                      React.createElement('div', null,
                        React.createElement('div', { className:'text-sm font-semibold text-slate-800 dark:text-slate-100' }, 'Рабочее пространство'),
                        React.createElement('div', { className:'text-xs text-slate-500 dark:text-slate-400' }, 'Selenization Alfa 0.1')
                      )
                    ),
                    React.createElement('div', { className:'flex items-center gap-2' },
                      React.createElement('button', { onClick: createChat, className:'px-3 py-1.5 text-sm rounded-xl bg-slate-900 text-white dark:bg-white dark:text-slate-900 shadow hover:opacity-90 md:hidden' }, '+ Новый'),
                      React.createElement('button', { onClick: function(){ alert('Подключите свой бэкенд API для реальных ответов ИИ.'); }, className:'px-3 py-1.5 text-sm rounded-xl border border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/5' }, 'Подключить API')
                    )
                  ),
                  React.createElement('div', { ref: scrollRef, className:'flex-1 overflow-y-auto px-4 md:px-6 py-4 space-y-4 scroll-smooth' },
                    (active && active.messages || []).map(function(m){ return React.createElement(MessageBubble, { key:m.id, role:m.role, text:m.text, ts:m.ts }); }),
                    isThinking && React.createElement(AssistantTyping),
                    (!active || (active.messages||[]).length===0) && !isThinking && React.createElement(EmptyState)
                  ),
                  React.createElement('div', { className:'px-4 md:px-6 pb-5' },
                    React.createElement('div', { className:'mx-auto max-w-3xl' },
                      React.createElement('div', { className:'rounded-2xl border border-slate-200 dark:border-white/10 bg-white/70 dark:bg-slate-900/60 backdrop-blur shadow-sm' },
                        React.createElement('div', { className:'flex items-end gap-2 p-2' },
                          React.createElement('button', { className:'p-2 rounded-xl hover:bg-slate-100 dark:hover:bg-white/5', title:'Загрузить файл', onClick: function(){ alert('Заглушка загрузки файла'); } }, React.createElement(PaperclipIcon)),
                          React.createElement('textarea', { value: input, onChange: function(e){ setInput(e.target.value); }, onKeyDown: function(e){ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); onSend(); } }, rows:1, placeholder:'Напишите сообщение для Selenization…', className:'flex-1 resize-none bg-transparent outline-none p-2 text-sm md:text-base text-slate-900 dark:text-slate-100 placeholder-slate-400 max-h-40' }),
                          React.createElement('button', { onClick:onSend, disabled:!(input||'').trim() || isThinking, className: cx('px-4 py-2 rounded-xl text-sm font-medium transition', (input||'').trim() && !isThinking ? 'bg-gradient-to-r from-indigo-600 to-sky-500 text-white shadow hover:opacity-95' : 'bg-slate-200 text-slate-500 dark:bg-white/10 dark:text-slate-400 cursor-not-allowed') }, 'Отправить')
                        ),
                        React.createElement('div', { className:'px-3 pb-2 text-[11px] text-slate-500 dark:text-slate-400' }, 'Selenization может ошибаться. Данные из рабочей области не используются для обучения моделей.')
                      )
                    )
                  )
                )
              )
            )
          );
        }

        // Mount
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
      })();
    </script>
  </body>
</html>
